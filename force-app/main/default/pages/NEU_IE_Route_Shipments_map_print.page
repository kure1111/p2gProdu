<!--
 - Created by jamarin on 20/05/2019.
 -->

<apex:page standardController="Customer_Quote__c" extensions="NEU_IE_Route_Shipments_map" sidebar="false" docType="html-5.0" showHeader="false">

    <apex:includeScript value="{!$Resource.jquery_1_10_2}"/>
    <apex:includeScript value="{!$Resource.neurored_jquery}"/>
    <apex:includeScript value="{!$Resource.jquery_ui_1_10_3}"/>
    <apex:stylesheet value="{!URLFOR($Resource.jquery_ui_1_10_3_css,'jquery-ui-1.10.3.min.css')}"/>
    <!--<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false"></script>-->
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyAK8UqXuiT9IFTwkvhF-Nh1wS2JAdk6Fig"></script>
    <style>
        .sep
        {
            width:20px;
        }
        .tdmil
        {
            vertical-align:top;
            position:relative;
            min-width: 5.5em;
        }
        .tdmil img
        {
            position:absolute;
            left:-20px;
            top:25px;
        }
        .tdmil .datestring
        {
            position:absolute;
            left:-2.7em;
            top:0px;
            padding:2px;
            border:3px #30caff solid;
        }
        .tdmilm
        {
            text-align:center;
        }
        .tdstatus
        {
            text-align:center;
        }
        .tdtrade
        {
            text-align:center;
            vertical-align:baseline;
        }
        .tdtrade.textleft
        {
            text-align:left;
        }
        .tdtrade.textright
        {
            text-align:right;
        }
        .line1
        {
            background-color:#d9f5ff;
            text-align:center;
        }
        .line2
        {
            background-color:#b4ebff;
            text-align:center;
        }
        .line3
        {
            background-color:#ced6d9;
            text-align:center;
        }
        .line4
        {
            background-color:#d9f5ff;
            text-align:center;
        }
        #graph td
        {
            border:1px solid white;
        }
        #graph td.nobl
        {
            border-left:0;
        }
        #graph td.nobr
        {
            border-right:0;
        }
        html{background-color:#ffffff !important;}
        #buttonMaps { cursor: pointer; }
        .mapIcon{margin-left: 38%;}
        .linkIconMap{margin-left: 37.5%;font-size: x-large;}
    </style>
    <script>
        var n$ = jQuery.noConflict();
        var map_inicio;
        var map;
        var markers = [];
        var geocoder;
        var all_direction = [];
        /*var origen_ruta;
        var destino_ruta;
        var origen_ruta2;
        var destino_ruta2;
        var origen_ruta3;
        var destino_ruta3;
        var origen_rail_road;
        var origen_rail_road2;
        var origen_rail_road3;
        var destino_rail_road;
        var destino_rail_road2;
        var destino_rail_road3;*/

        var origen_rail_road_route0;
        var origen_rail_road_route1;
        var origen_rail_road_route2;
        var origen_rail_road_route3;
        var origen_rail_road_route4;
        var origen_rail_road_route5;

        var destino_rail_road_route0;
        var destino_rail_road_route1;
        var destino_rail_road_route2;
        var destino_rail_road_route3;
        var destino_rail_road_route4;
        var destino_rail_road_route5;

        var waypoint_1_route1;
        var waypoint_2_route1;
        var waypoint_3_route1;
        var waypoint_4_route1;
        var waypoint_5_route1;

        var waypoint_1_route2;
        var waypoint_2_route2;
        var waypoint_3_route2;
        var waypoint_4_route2;
        var waypoint_5_route2;

        var waypoint_1_route3;
        var waypoint_2_route3;
        var waypoint_3_route3;
        var waypoint_4_route3;
        var waypoint_5_route3;

        var route1_check = false;
        var route2_check = false;
        var route3_check = false;
        var route4_check = false;
        var route5_check = false;

        var route1_freight;
        var route2_freight;
        var route3_freight;
        var route4_freight;
        var route5_freight;

       n$(document).ready(function()
       {
            google.maps.event.addDomListener(window, 'load', initialize_inicio);
       });

        var repintar_zoom = false;
        function initialize_inicio()
        {
            var mundo= new google.maps.LatLng(8.4324774,20.1243519);
            var mapOptions = {
                zoom: 3,
                center: mundo
                };
            map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
            geocoder = new google.maps.Geocoder();

            updatemap();
        }

        function updatemap()
        {
            forgetmarkers();
            var all_direction_string = n$(n$.sfId('{!$Component.form.block0.direcciones}')).getString();
            all_direction = all_direction_string.split('_&&_');
            showNextLocation(-1);
        }

        function forgetmarkers()
        {
            for(var i=0;i<markers.length;i++)
                markers[i].setMap(null);
            markers=[];
        }

        var directionsService0 = new google.maps.DirectionsService();
        var directionsService = new google.maps.DirectionsService();
        var directionsService2 = new google.maps.DirectionsService();
        var directionsService3 = new google.maps.DirectionsService();
        var directionsService4 = new google.maps.DirectionsService();
        var directionsService5 = new google.maps.DirectionsService();
        var route_paint_init = false;
        var directionsDisplay0;
        var directionsDisplay;
        var directionsDisplay2;
        var directionsDisplay3;
        var directionsDisplay4;
        var directionsDisplay5;
        var waypts = [];

        function paint_route_rail()
        {
            if(origen_rail_road_route1 != null && origen_rail_road_route1 != '' && destino_rail_road_route1 != null && destino_rail_road_route1 != '')
            {

                directionsService = new google.maps.DirectionsService();
                directionsDisplay = new google.maps.DirectionsRenderer();
                directionsDisplay.setMap(null);
                waypts = [];
                var start = origen_rail_road_route1;
                var end = destino_rail_road_route1;
                /*if(destino_rail_road != '' && destino_rail_road != null)
                    end = destino_rail_road;
               else if(destino_rail_road2 != null && destino_rail_road2 != '')
                    end = destino_rail_road2;*/

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.TRANSIT
                  };

                  //esto es para pintar la route
                  directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay.setMap(map);
                 directionsDisplay.setOptions( { suppressMarkers: true } );
                 directionsDisplay.setOptions({polylineOptions: {    strokeColor: 'red',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_rail2()
        {
            if(origen_rail_road_route2 != null && origen_rail_road_route2 != '' && (destino_rail_road_route2 != null && destino_rail_road_route2 != ''))
            {

                directionsService2 = new google.maps.DirectionsService();
                directionsDisplay2 = new google.maps.DirectionsRenderer();
                directionsDisplay2.setMap(null);
                waypts = [];
                var start = origen_rail_road_route2;
                var end = destino_rail_road_route2;
                /*if(destino_rail_road != '' && destino_rail_road != null)
                    end = destino_rail_road;
               else if(destino_rail_road2 != null && destino_rail_road2 != '')
                    end = destino_rail_road2;*/

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.TRANSIT
                  };

                  //esto es para pintar la route
                  directionsService2.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay2.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay2.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay2.setMap(map);
                 directionsDisplay2.setOptions( { suppressMarkers: true } );
                 directionsDisplay2.setOptions({polylineOptions: {    strokeColor: 'red',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_rail3()
        {
            if(origen_rail_road_route3 != null && origen_rail_road_route3 != '' && (destino_rail_road_route3 != null && destino_rail_road_route3 != ''))
            {

                directionsService3 = new google.maps.DirectionsService();
                directionsDisplay3 = new google.maps.DirectionsRenderer();
                directionsDisplay3.setMap(null);
                waypts = [];
                var start = origen_rail_road_route3;
                var end = destino_rail_road_route3;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.TRANSIT
                  };

                  //esto es para pintar la route
                  directionsService3.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay3.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay3.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay3.setMap(map);
                 directionsDisplay3.setOptions( { suppressMarkers: true } );
                 directionsDisplay3.setOptions({polylineOptions: {    strokeColor: 'red',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_rail4()
        {
            if(origen_rail_road_route4 != null && origen_rail_road_route4 != '' && (destino_rail_road_route4 != null && destino_rail_road_route4 != ''))
            {

                directionsService4 = new google.maps.DirectionsService();
                directionsDisplay4 = new google.maps.DirectionsRenderer();
                directionsDisplay4.setMap(null);
                waypts = [];
                var start = origen_rail_road_route4;
                var end = destino_rail_road_route4;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.TRANSIT
                  };

                  //esto es para pintar la route
                  directionsService4.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay4.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay4.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay4.setMap(map);
                 directionsDisplay4.setOptions( { suppressMarkers: true } );
                 directionsDisplay4.setOptions({polylineOptions: {    strokeColor: 'red',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_rail5()
        {
            if(origen_rail_road_route5 != null && origen_rail_road_route5 != '' && (destino_rail_road_route5 != null && destino_rail_road_route5 != ''))
            {

                directionsService5 = new google.maps.DirectionsService();
                directionsDisplay5 = new google.maps.DirectionsRenderer();
                directionsDisplay5.setMap(null);
                waypts = [];
                var start = origen_rail_road_route5;
                var end = destino_rail_road_route5;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.TRANSIT
                  };

                  //esto es para pintar la route
                  directionsService5.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay5.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay5.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay5.setMap(map);
                 directionsDisplay5.setOptions( { suppressMarkers: true } );
                 directionsDisplay5.setOptions({polylineOptions: {    strokeColor: 'red',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_road0()
        {
            if((origen_rail_road_route0 != null && origen_rail_road_route0 != '') || (destino_rail_road_route0 != null && destino_rail_road_route0 != ''))
            {
                directionsService0 = new google.maps.DirectionsService();
                directionsDisplay0 = new google.maps.DirectionsRenderer();
                directionsDisplay0.setMap(null);
                waypts = [];
                var start = origen_rail_road_route0;
                var end = destino_rail_road_route0;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.DRIVING
                  };

                  //esto es para pintar la route
                  directionsService0.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay0.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay0.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay0.setMap(map);
                 directionsDisplay0.setOptions( { suppressMarkers: true } );
                 directionsDisplay0.setOptions({polylineOptions: {    strokeColor: 'green',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_road()
        {
            if((origen_rail_road_route1 != null && origen_rail_road_route1 != '') || (destino_rail_road_route1 != null && destino_rail_road_route1 != ''))
            {
                directionsService = new google.maps.DirectionsService();
                directionsDisplay = new google.maps.DirectionsRenderer();
                directionsDisplay.setMap(null);
                waypts = [];
                var start = origen_rail_road_route1;
                var end = destino_rail_road_route1;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.DRIVING
                  };

                  //esto es para pintar la route
                  directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay.setMap(map);
                 directionsDisplay.setOptions( { suppressMarkers: true } );
                 directionsDisplay.setOptions({polylineOptions: {    strokeColor: 'blue',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_road2()
        {
            if((origen_rail_road_route2 != null && origen_rail_road_route2 != '') || (destino_rail_road_route2 != null && destino_rail_road_route2 != ''))
            {

                directionsService2 = new google.maps.DirectionsService();
                directionsDisplay2 = new google.maps.DirectionsRenderer();
                directionsDisplay2.setMap(null);
                waypts = [];
                var start = origen_rail_road_route2;
                var end = destino_rail_road_route2;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.DRIVING
                  };

                  //esto es para pintar la route
                  directionsService2.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay2.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay2.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay2.setMap(map);
                 directionsDisplay2.setOptions( { suppressMarkers: true } );
                 directionsDisplay2.setOptions({polylineOptions: {    strokeColor: 'blue',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_road3()
        {
            if((origen_rail_road_route3 != null && origen_rail_road_route3 != '') || (destino_rail_road_route3 != null && destino_rail_road_route3 != ''))
            {

                directionsService3 = new google.maps.DirectionsService();
                directionsDisplay3 = new google.maps.DirectionsRenderer();
                directionsDisplay3.setMap(null);
                waypts = [];

                var start = origen_rail_road_route3;
                var end = destino_rail_road_route3;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.DRIVING
                  };

                  //esto es para pintar la route
                  directionsService3.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay3.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay3.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay3.setMap(map);
                 directionsDisplay3.setOptions( { suppressMarkers: true } );
                 directionsDisplay3.setOptions({polylineOptions: {    strokeColor: 'blue',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_road4()
        {
            if((origen_rail_road_route4 != null && origen_rail_road_route4 != '') || (destino_rail_road_route4 != null && destino_rail_road_route4 != ''))
            {

                directionsService4 = new google.maps.DirectionsService();
                directionsDisplay4 = new google.maps.DirectionsRenderer();
                directionsDisplay4.setMap(null);
                waypts = [];

                var start = origen_rail_road_route4;
                var end = destino_rail_road_route4;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.DRIVING
                  };

                  //esto es para pintar la route
                  directionsService4.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay4.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay4.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay4.setMap(map);
                 directionsDisplay4.setOptions( { suppressMarkers: true } );
                 directionsDisplay4.setOptions({polylineOptions: {    strokeColor: 'blue',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }

        function paint_route_road5()
        {
            if((origen_rail_road_route5 != null && origen_rail_road_route5 != '') || (destino_rail_road_route5 != null && destino_rail_road_route5 != ''))
            {

                directionsService5 = new google.maps.DirectionsService();
                directionsDisplay5 = new google.maps.DirectionsRenderer();
                directionsDisplay5.setMap(null);
                waypts = [];

                var start = origen_rail_road_route5;
                var end = destino_rail_road_route5;

               /*for(var i=0;i<markers.length;i++)
               {
                    if(markers[i].location != start && markers[i].location != end && (markers[i].tipo == 'D' || markers[i].tipo == 'POD' ))
                      waypts.push({location: markers[i].location, stopover:true });
               }*/

               route_paint_init = true;

               var request = {
                      origin: start,
                      destination: end,
                     // waypoints: waypts,
                      //waypoints: markers,
                     // optimizeWaypoints: true,
                      travelMode: google.maps.TravelMode.DRIVING
                  };

                  //esto es para pintar la route
                  directionsService5.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK)
                    {
                      directionsDisplay5.setDirections(response);
                      repintar_zoom = true;
                      directionsDisplay5.set('preserveViewport',true);
                    }
                  });

                 directionsDisplay5.setMap(map);
                 directionsDisplay5.setOptions( { suppressMarkers: true } );
                 directionsDisplay5.setOptions({polylineOptions: {    strokeColor: 'blue',  strokeWeight: 5   } });//strokeOpacity: 0.5,
             }
        }
        var primera = true;
        function showNextLocation(counter)
        {
            var location;
            var ico;
            var freight_mode_shipment;
            if(all_direction != null && all_direction.length != 0)
            {
                counter++;
                var direction_icon;
                if(all_direction.length >counter)
                {
                    direction_icon =all_direction[counter].split('_&_');
                    location=direction_icon[0];
                    freight_mode_shipment = direction_icon[3];

                    if(direction_icon[1] == 'O')
                    {
                        ico="{!URLFOR($Resource.NEU_IE_Route_Shipments_map,'o.png')}";
                        origen_rail_road_route0 = location;

                    }
                    else if(direction_icon[1] == 'POL')
                    {
                        ico="{!URLFOR($Resource.NEU_IE_Route_Shipments_map,'POL.png')}";
                        if(primera == true)
                        {
                            destino_rail_road_route0 = location;
                            primera = false;
                        }
                        if(freight_mode_shipment == 'Road' || freight_mode_shipment == 'Rail')
                        {
                            if(origen_rail_road_route1 == null || origen_rail_road_route1 == '')
                            {
                                origen_rail_road_route1 = location;
                                route1_freight =direction_icon[3];

                            }
                            else if(origen_rail_road_route2 == null || origen_rail_road_route2 == '')
                            {
                                origen_rail_road_route2 = location;
                                route2_freight =direction_icon[3];

                            }
                            else if(origen_rail_road_route3 == null || origen_rail_road_route3 == '')
                            {
                                origen_rail_road_route3 = location;
                                route3_freight =direction_icon[3];

                            }
                            else if(origen_rail_road_route4 == null || origen_rail_road_route4 == '')
                            {
                                origen_rail_road_route4 = location;
                                route4_freight =direction_icon[3];

                            }
                            else if(origen_rail_road_route5 == null || origen_rail_road_route5 == '')
                            {
                                origen_rail_road_route5 = location;
                                route5_freight =direction_icon[3];

                            }

                        }
                    }
                    else if(direction_icon[1] == 'ts1')
                    {
                        ico="{!URLFOR($Resource.TrackTrace,'ts1.png')}";

                        if(freight_mode_shipment == 'Road' || freight_mode_shipment == 'Rail')
                        {
                            if(waypoint_1_route1 == null || waypoint_1_route1 == '')
                                waypoint_1_route1 = location;
                            else if(waypoint_1_route2 == null || waypoint_1_route2 == '')
                                waypoint_1_route2 = location;
                            else if(waypoint_1_route3 == null || waypoint_1_route3 == '')
                                waypoint_1_route3 = location;
                            else if(waypoint_1_route4 == null || waypoint_1_route4 == '')
                                waypoint_1_route4 = location;
                            else if(waypoint_1_route5 == null || waypoint_1_route5 == '')
                                waypoint_1_route5 = location;
                        }

                    }
                    else if(direction_icon[1] == 'ts2')
                    {
                        ico="{!URLFOR($Resource.TrackTrace,'ts2.png')}";

                       if(freight_mode_shipment == 'Road' || freight_mode_shipment == 'Rail')
                        {
                            if(waypoint_2_route1 == null || waypoint_2_route1 == '')
                                waypoint_2_route1 = location;
                            else if(waypoint_2_route2 == null || waypoint_2_route2 == '')
                                waypoint_2_route2 = location;
                            else if(waypoint_2_route3 == null || waypoint_2_route3 == '')
                                waypoint_2_route3 = location;
                            else if(waypoint_2_route4 == null || waypoint_2_route4 == '')
                                waypoint_2_route4 = location;
                            else if(waypoint_2_route5 == null || waypoint_2_route5 == '')
                                waypoint_2_route5 = location;
                        }
                    }
                    else if(direction_icon[1] == 'ts3')
                    {
                        ico="{!URLFOR($Resource.TrackTrace,'ts3.png')}";
                        if(freight_mode_shipment == 'Road' || freight_mode_shipment == 'Rail')
                        {
                            if(waypoint_3_route1 == null || waypoint_3_route1 == '')
                                waypoint_1_route1 = location;
                            else if(waypoint_3_route2 == null || waypoint_3_route2 == '')
                                waypoint_3_route2 = location;
                            else if(waypoint_3_route3 == null || waypoint_3_route3 == '')
                                waypoint_3_route3 = location;
                            else if(waypoint_3_route4 == null || waypoint_3_route4 == '')
                                waypoint_3_route4 = location;
                            else if(waypoint_3_route5 == null || waypoint_3_route5 == '')
                                waypoint_3_route5 = location;
                        }
                    }

                    else if(direction_icon[1] == 'POC')
                    {
                        ico="{!URLFOR($Resource.NEU_IE_Route_Shipments_map,'POC.png')}";

                    }

                    else if(direction_icon[1] == 'POD')
                    {
                        ico="{!URLFOR($Resource.NEU_IE_Route_Shipments_map,'POD.png')}";

                       if(freight_mode_shipment == 'Road' || freight_mode_shipment == 'Rail')
                       {
                            if(destino_rail_road_route1 == null || destino_rail_road_route1 == '')
                                destino_rail_road_route1 = location;
                            else if(destino_rail_road_route2 == null || destino_rail_road_route2 == '')
                                destino_rail_road_route2 = location;
                            else if(destino_rail_road_route3 == null || destino_rail_road_route3 == '')
                                destino_rail_road_route3 = location;
                            else if(destino_rail_road_route4 == null || destino_rail_road_route4 == '')
                                destino_rail_road_route4 = location;
                            else if(destino_rail_road_route5 == null || destino_rail_road_route5 == '')
                                destino_rail_road_route5 = location;
                        }

                    }
                    else if(direction_icon[1] == 'D')
                    {
                        ico="{!URLFOR($Resource.NEU_IE_Route_Shipments_map,'D.png')}";
                    }
                }
            }

            if(location)
                showLocation(location,ico,counter,direction_icon[2],direction_icon[1]);
            else
            {
                if(all_direction != null && all_direction.length != 0)
                {
                    if(all_direction.length >counter)
                        showNextLocation(counter);
                    else
                    {
                       // pintar_ruta();
                       // pintar_ruta2();
                        //if(n$('.freight_mode_ie').val() =='Road')
                        if(origen_rail_road_route0 != null && origen_rail_road_route0 != '' && destino_rail_road_route0 != null && destino_rail_road_route0 !='')
                            paint_route_road0();

                        if(route1_freight == 'Road')
                            paint_route_road();
                        else if(route1_freight == 'Rail')
                            paint_route_rail();

                        if(route2_freight == 'Road')
                            paint_route_road2();
                        else if(route2_freight == 'Rail')
                            paint_route_rail2();

                        if(route3_freight == 'Road')
                            paint_route_road3();
                        else if(route3_freight == 'Rail')
                            paint_route_rail3();

                        if(route4_freight == 'Road')
                            paint_route_road4();
                        else if(route4_freight == 'Rail')
                            paint_route_rail4();

                        if(route5_freight == 'Road')
                            paint_route_road5();
                        else if(route5_freight == 'Rail')
                            paint_route_rail5();

                        //map.setZoom(3);
                        //this.map.map.setZoom(3);//maxZoom
                        //map.setOptions({    maxZoom: 3});//buscar cosa me
                        //map.setZoom(3);

                    }
                }
            }
        }



        function showLocation(location,ico,counter,datos,tipo)
        {
              geocoder.geocode( { 'address': location}, function(results, status) {
              if (status == google.maps.GeocoderStatus.OK)
              {
                 map.setCenter(results[0].geometry.location);
                 var marker = new google.maps.Marker({
                     map: map,
                     position: results[0].geometry.location,
                     location: location,
                     tipo: tipo,
                     animation: google.maps.Animation.DROP,
                     icon:ico
                 });

                 markers.push(marker);

                 var infowindow = new google.maps.InfoWindow({
                   content:'<b>'+ location.trim()+' </b><br />'+datos
                   });

                 google.maps.event.addListener(marker, 'click', function() {
                   infowindow.open(marker.get('map'), marker);
                 });
                 setTimeout(function (){showNextLocation(counter);}, 200);
              }
              else if(status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT)
              {
                setTimeout(function(){showLocation(location,ico,counter,datos,tipo);},2000);
              }
              else if(status == google.maps.GeocoderStatus.ZERO_RESULTS)
              {
                    var pos=location.indexOf(' ');
                    if(pos>=0)
                    {
                        location=location.substring(pos+1);
                        setTimeout(function (){showLocation(location,ico,counter,datos,tipo);},0);
                    }
                    else
                        setTimeout(function(){showNextLocation(counter);},200);
               }
             });
        }

         function showMaps() {
             /*
            document.getElementById('buttonMaps').style.display = 'none';
            document.getElementById('map_canvas').style.display = 'block';
            initialize_inicio();
            */
          }

    </script>
    <apex:form id="form">
        <apex:inputhidden value="{!Customer_Quote__c.Freight_Mode__c}" html-class="freight_mode_ie"/>
        <apex:outputpanel id="panel">
            <apex:pageBlock id="block0" mode="maindetail">
                <div id="map_canvas" style="width:100%; height: 545px;"></div>
                <apex:inputHidden value="{!direcciones_recogidas}" id="direcciones" />
            </apex:pageBlock>
        </apex:outputpanel>
    </apex:form>
</apex:page>