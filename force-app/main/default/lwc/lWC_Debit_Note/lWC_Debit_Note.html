<!-- sldsValidatorIgnore -->
<!-- sldsValidatorIgnore -->
<!-- sldsValidatorIgnore -->
<!-- sldsValidatorIgnore -->
<!-- sldsValidatorIgnore -->
<template>   
    <div if:false={isInvoice}>
        <div if:true={bandera}>        
            <template if:true={isModalOpen}>  
                <div if:true={isPrincipalModal}>
                    <section role=" dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
                        <div class="slds-modal__container">                                                                                      
                            <header class="slds-modal__header">
                                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                                    <lightning-icon icon-name="utility:close"
                                        alternative-text="close"
                                        variant="inverse"
                                        size="small" ></lightning-icon>
                                    <span class="slds-assistive-text">Close</span>
                                </button>
                                <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Debit Note</h2>
                            </header>                                                                                                
                            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">                                    
                                <div if:false={itsAllOK}>                                                                                                                     
                                    <lightning-tabset variant="scoped">                                                                                                      
                                            <lightning-tab label="InformaciÃ³n de la Debit Note">   
                                                <div class="slds-m-top_medium slds-m-bottom_x-large">
                                                    <div class="slds-p-around_medium lgc-bg" style="position: relative;">
                                                        <div if:true={isLoadedAll}>
                                                            <lightning-spinner alternative-text="Loading" size="large" class="spinnerClass"></lightning-spinner>
                                                        </div>
                                                        <div if:false={isDebitNote}>
                                                            <template for:each={debitN} for:item="record">                                                                                                                                                
                                                                <div class="slds-grid slds-wrap" key={record.Id}> 
                                                                    <div class="slds-col slds-size_12-of-12">
                                                                        <div class="slds-clearfix">
                                                                            <div class="slds-float_right">                                                                                
                                                                                <lightning-button label="Actualizar" icon-name="utility:refresh" onclick={refreshModal}></lightning-button>
                                                                            </div>
                                                                        </div>                                                                                   
                                                                        <input type="hidden" value={record.Id} class="dnId">
                                                                    </div>   
                                                                    <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                                                        <lightning-input  type="text" label="Nombre de la Debit Note"  value={record.Name}  readonly></lightning-input>
                                                                        <lightning-input  type="text" label="Account for (Customer)"  value={record.Account_for__r.Name} readonly></lightning-input>
                                                                    </div>
                                                                    <div class="slds-col slds-size_1-of-1 slds-large-size_6-of-12">
                                                                        <lightning-input  type="text" label="Shipment"  value={spName}  readonly style="color: red;"></lightning-input>                                                                            
                                                                    </div>                                                                                                                                                              
                                                                    <div class="slds-col slds-size_1-of-1 slds-large-size_8-of-12">
                                                                        <lightning-card title="Shipment Number">
                                                                            <div if:true={sp1}>
                                                                                <div if:true={record.Shipment_Number_1__c}>
                                                                                    <div if:true={sp1Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_1__c} record-name={record.Shipment_Number_1__r.Name} style="color: red;"></c-l-w-c-_-change-object>
                                                                                    </div>
                                                                                    <div if:false={sp1Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_1__c} record-name={record.Shipment_Number_1__r.Name}></c-l-w-c-_-change-object>                                                                                        
                                                                                    </div>                                                                                    
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_1__c}>
                                                                                    <c-l-w-c-_-lookup lookup-label="Agregar Shipment" object-api-name="Shipment__c" icon-name="standard:account" carrier-id={accountFor} record-type = ""
                                                                                    onrecordselection={onAccountSelection}></c-l-w-c-_-lookup>
                                                                                </div>
                                                                            </div>                                                                           
                                                                            <div if:true={sp2}>
                                                                                <div if:true={record.Shipment_Number_2__c}>
                                                                                    <div if:true={sp2Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_2__c} record-name={record.Shipment_Number_2__r.Name} style="color: red;"></c-l-w-c-_-change-object>
                                                                                    </div>
                                                                                    <div if:false={sp2Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_2__c} record-name={record.Shipment_Number_2__r.Name}></c-l-w-c-_-change-object>
                                                                                        <input type="hidden" class="sp2" value={record.Shipment_Number_2__r.Id}>
                                                                                    </div>                                                                                    
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_2__c}>
                                                                                    <c-l-w-c-_-lookup lookup-label="Agregar Shipment" object-api-name="Shipment__c" icon-name="standard:account" carrier-id={accountFor} record-type = ""
                                                                                    onrecordselection={onAccountSelection}></c-l-w-c-_-lookup>
                                                                                </div>
                                                                            </div>
                                                                            <div if:true={sp3}>
                                                                                <div if:true={record.Shipment_Number_3__c}>            
                                                                                    <div if:true={sp3Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_3__c} record-name={record.Shipment_Number_3__r.Name} style="color: red;"></c-l-w-c-_-change-object>
                                                                                    </div>
                                                                                    <div if:false={sp3Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_3__c} record-name={record.Shipment_Number_3__r.Name}></c-l-w-c-_-change-object>
                                                                                        <input type="hidden" class="sp3" value={record.Shipment_Number_3__r.Id}>
                                                                                    </div>                                                    
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_3__c}>
                                                                                    <c-l-w-c-_-lookup lookup-label="Agregar Shipment" object-api-name="Shipment__c" icon-name="standard:account" carrier-id={accountFor} record-type = ""
                                                                                    onrecordselection={onAccountSelection}></c-l-w-c-_-lookup>
                                                                                </div>
                                                                            </div>
                                                                            <div if:true={sp4}>
                                                                                <div if:true={record.Shipment_Number_4__c}>
                                                                                    <div if:true={sp4Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_4__c} record-name={record.Shipment_Number_4__r.Name} style="color: red;"></c-l-w-c-_-change-object>
                                                                                    </div>
                                                                                    <div if:false={sp4Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_4__c} record-name={record.Shipment_Number_4__r.Name}></c-l-w-c-_-change-object>
                                                                                        <input type="hidden" class="sp4" value={record.Shipment_Number_4__r.Id}>
                                                                                    </div>
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_4__c}>
                                                                                    <c-l-w-c-_-lookup lookup-label="Agregar Shipment" object-api-name="Shipment__c" icon-name="standard:account" carrier-id={accountFor} record-type = ""
                                                                                    onrecordselection={onAccountSelection}></c-l-w-c-_-lookup>
                                                                                </div>
                                                                            </div>
                                                                            <div if:true={sp5}>
                                                                                <div if:true={record.Shipment_Number_5__c}>
                                                                                    <div if:true={sp5Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_5__c} record-name={record.Shipment_Number_5__r.Name} style="color: red;"></c-l-w-c-_-change-object>
                                                                                    </div>
                                                                                    <div if:false={sp5Actual}>
                                                                                        <c-l-w-c-_-change-object object-name="Shipment" icon-name="custom:custom13" record-id={record.Id} obj-id={record.Shipment_Number_5__c} record-name={record.Shipment_Number_5__r.Name}></c-l-w-c-_-change-object>
                                                                                        <input type="hidden" class="sp5" value={record.Shipment_Number_5__r.Id}>
                                                                                    </div>
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_5__c}>
                                                                                    <c-l-w-c-_-lookup lookup-label="Agregar Shipment" object-api-name="Shipment__c" icon-name="standard:account" carrier-id={accountFor} record-type = ""
                                                                                    onrecordselection={onAccountSelection}></c-l-w-c-_-lookup>
                                                                                </div>                                                                                                                                                                                                                                                                                                                                    
                                                                            </div>
                                                                        </lightning-card>
                                                                    </div>
                                                                    <div class="slds-col slds-size_1-of-1 slds-large-size_4-of-12">
                                                                        <lightning-card title="Shipment Status Planner">
                                                                            <div if:true={sp1}>
                                                                                <div if:true={record.Shipment_Number_1__c} >
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly  value={record.Shipment_Status_Planner_1__c} />                                                                                                                                                        
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                                                                                               
                                                                                </div> 
                                                                                <div if:false={record.Shipment_Number_1__c}>                                                                                    
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly  />                                                                                                                                                        
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                       
                                                                                </div>   
                                                                            </div>
                                                                            <div if:true={sp2}>
                                                                                <div if:true={record.Shipment_Number_2__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly value={record.Shipment_Status_Planner_2__c} />                                                                                                                                                        
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                    
                                                                                </div> 
                                                                                <div if:false={record.Shipment_Number_2__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly />
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                                                                                 
                                                                                </div>                                                        
                                                                            </div>         
                                                                            <div if:true={sp3}>
                                                                                <div if:true={record.Shipment_Number_3__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly value={record.Shipment_Status_Planner_3__c}/>
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                     
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_3__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly/>
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                                                                                 
                                                                                </div>                                                         
                                                                            </div>  
                                                                            <div if:true={sp4}>
                                                                                <div if:true={record.Shipment_Number_4__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly value={record.Shipment_Status_Planner_4__c}/>
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                           
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_4__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly/>
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                                                                          
                                                                                </div>                                                         
                                                                            </div>        
                                                                            <div if:true={sp5}>
                                                                                <div if:true={record.Shipment_Number_5__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly value={record.Shipment_Status_Planner_5__c}/>
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                    
                                                                                </div>
                                                                                <div if:false={record.Shipment_Number_5__c}>
                                                                                    <div class="slds-form-element">
                                                                                        <label class="slds-form-element__label" style="color: white ;">Status</label>
                                                                                        <div class="slds-form-element__control">                                                                                                                                                                                                      
                                                                                            <input type="text" class=" slds-input" readonly />
                                                                                        </div>                                                                    
                                                                                    </div>                                                                                                                                            
                                                                                </div>                                                                                                                  
                                                                            </div>                                  
                                                                        </lightning-card>
                                                                    </div> 
                                                                </div>                                                                                                                                                                                           
                                                            </template> 
                                                        </div>
                                                        <div if:true={isDebitNote}>
                                                            <div class="slds-text-heading_medium slds-align_absolute-center">El Shipment: {spName} no cuenta con una  &nbsp;  <b style="color: red;"> Debit Note</b>.</div><br>
                                                            <div class="slds-align_absolute-center" if:false={searchDN}>
                                                                <lightning-button variant="success" label="Crear Debit Note" title="Crear Debit Note" onclick={createDebitNote} class="slds-m-left_x-small" ></lightning-button>
                                                                <lightning-button variant="brand" label="Buscar Debit Note" title="Buscar Debit Note" onclick={searchDebitNote} class="slds-m-left_x-small" ></lightning-button>
                                                            </div>
                                                            <div if:true={searchDN}>
                                                                <c-l-w-c-_-lookup lookup-label="Buscar Debit Note" object-api-name="Debit_Note__c" icon-name="custom:custom11" carrier-id={accountFor} record-type = ""
                                                                onrecordselection={onAccountSelection}></c-l-w-c-_-lookup>
                                                            </div>                                            
                                                        </div>                                                                                                                                                                                                               
                                                    </div>
                                                </div>                                                                               
                                            </lightning-tab>                                                                
                                    </lightning-tabset>
                                </div>                                                
                            </div>                    
                            <footer class="slds-modal__footer">                                  
                                <div if:true={isDebitNote}>
                                    <lightning-button label="Regresar" title="Regresar" onclick={regresarOpciones} class="slds-m-left_x-small"></lightning-button> 
                                </div>
                                <div if:false={isDebitNote}>                                    
                                    <lightning-button variant="success" label="Crear Invoices" title="Create Invoices" onclick={CrearInvoicesBtn} class="slds-m-left_x-small" ></lightning-button>
                                    <lightning-button variant="destructive" label="Cerrar" title="Closed Action" onclick={closeModal} class="slds-m-left_x-small"></lightning-button>                                                
                                </div>
                            </footer>                                                                                                                
                        </div>
                    </section>
                </div>              
                <div if:true={isCompConfirmation}>
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-2" class="slds-modal slds-fade-in-open slds-modal_medium">
                        <div class="slds-modal__container">                                                                                                          
                            <header class="slds-modal__header">
                                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                                    <lightning-icon icon-name="utility:close"
                                        alternative-text="close"
                                        variant="inverse"
                                        size="small" ></lightning-icon>
                                    <span class="slds-assistive-text">Close</span>
                                </button>
                                <h2 id="modal-heading-02" class="slds-text-heading_medium slds-hyphenate">CreaciÃ³n de Invoices</h2>
                            </header>
                        
                            <div class="slds-is-relative">
                                <div if:true={isLoadedAll}>
                                    <lightning-spinner
                                        alternative-text="Loading..." variant="brand" size="large" >
                                    </lightning-spinner>
                                </div>                                                                                             
                                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2" style="height: 500px;">                               
                                    <lightning-tabset variant="scoped">                                         
                                        <lightning-tab label="Shipments para crear Debit Note">
                                            <div>
                                                <div class="slds-p-around_medium lgc-bg">
                                                    <div class="slds-box slds-theme_shade">
                                                        <h2><b style="color: red;">ATENCION:</b>&nbsp; Se va a crear la Debit Note para los siguientes Shipments</h2>
                                                    </div><br/>                                                 
                                                    <div class="slds-scrollable" style="height:100%; height: 100%;">                                       
                                                        <div class="slds-text-longform">                                                                                       
                                                            <template for:each={shipmentsLine} for:item="record">                                
                                                                <h3 class="slds-text-heading_medium slds-m-bottom_xx-small" key={record.Id}>Shipment Number: <b style="color:red">{record.shipmentName}</b> - Status: <b style="color:red">{record.statusSp}</b></h3>                                                                                                                                   
                                                                    <div class="slds-scrollable" style="height:100%; height: 100%;" key={record.Id}>
                                                                        <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                                                                            <thead>
                                                                                <tr class="slds-line-height_reset">
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Services Line">Services Line Name</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Carrier">Carrier</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Rate Category">Rate Category</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Codigo Sap">Codigo Sap</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Rate Name">Rate Name</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Units">Units</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Buy Amount">Buy Amount</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Sell Net Amount">Sell Net Amount</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Services Profit">Services Profit</div>
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <template for:each={record.servicesLines} for:item="line">
                                                                                <tbody key={line.Id}>
                                                                                    <tr class="slds-hint-parent">
                                                                                        <th data-label="Services Line" scope="row">
                                                                                            <div class="slds-truncate" title={line.Name}>{line.Name}</div>
                                                                                        </th>
                                                                                        <td data-label="Carrier">
                                                                                            <div class="slds-truncate" title={line.Carrier__c}>{line.Carrier__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Rate Category">
                                                                                            <div class="slds-truncate" title={line.Service_Rate_Category__c>{line.Service_Rate_Category__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Codigo Sap">
                                                                                            <div class="slds-truncate" title={line.Code_SAP__c}>{line.Code_SAP__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Rate Name">
                                                                                            <div class="slds-truncate" title={line.Service_Rate_Name__c}>{line.Service_Rate_Name__r.Name}</div>
                                                                                        </td>
                                                                                        <td data-label="Units">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Units__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Buy Amount">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Std_Buy_Amount_header_currency__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Sell Net Amount">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Sell_Amount__c}</div>
                                                                                        </td> 
                                                                                        <td data-label="Services Profit">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Service_Std_Profit__c}</div>
                                                                                        </td>                                                
                                                                                    </tr>                                           
                                                                                </tbody>
                                                                            </template>
                                                                        </table>    
                                                                    </div>   
                                                                    <br key={record}/>                                                                                                                                                                                                      
                                                            </template>                               
                                                        </div>
                                                    </div>
                                                </div>                                            
                                            </div>
                                        </lightning-tab>                                          
                                        <lightning-tab label="Shipments Omitidos">
                                            <div>
                                                <div class="slds-p-around_medium lgc-bg">
                                                    <div class="slds-box slds-theme_shade">
                                                        <h2><b style="color: red;">ATENCION:</b>&nbsp; Se va a crear una Debit Note a los Shipments que tengan los siguientes casos: <br/>
                                                            1. No cuenta con <b style="color:red">Folio</b> <br/>
                                                            <!--2. El estatus no esta en <b style="color: red;">Closed</b><br/>-->
                                                            2. No se va a crear / registrar  una Debit Note a los  Shipments que tengan una Invoice creada <!--y el estatus este en  <b style="color: red;">Closed</b> </b>--></h2>
                                                    </div><br/>                                                 
                                                    <div class="slds-scrollable" style="height:100%; height: 100%;">                                       
                                                        <div class="slds-text-longform">                                                              
                                                            <div class="slds-scrollable" style="height:100%; height: 100%;">
                                                                <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                                                                    <thead>
                                                                        <tr class="slds-line-height_reset">
                                                                            <th class="" scope="col">
                                                                                <div class="slds-truncate" title="Shipment Number">Shipment Number</div>
                                                                            </th>
                                                                            <th class="" scope="col">
                                                                                <div class="slds-truncate" title="Status">Status</div>
                                                                            </th>
                                                                            <th class="" scope="col">
                                                                                <div class="slds-truncate" title="Folio">Folio</div>
                                                                            </th> 
                                                                            <th class="" scope="col">
                                                                                <div class="slds-truncate" title="Invoice">Invoice</div>
                                                                            </th>                                                                                   
                                                                        </tr>
                                                                    </thead>
                                                                    <template for:each={shipmentsnotClose} for:item="record">
                                                                        <tbody key={record.Id}>
                                                                            <tr class="slds-hint-parent">
                                                                                <th data-label="Shipment Numbere" scope="row">
                                                                                    <div class="slds-truncate" title={record.shipmentName}>{record.shipmentName}</div>
                                                                                </th>
                                                                                <td data-label="Status">
                                                                                    <div class="slds-truncate" title={record.status}>{record.status}</div>
                                                                                </td>
                                                                                <td data-label="Folio">
                                                                                    <div class="slds-truncate">                                                                                        
                                                                                        <div if:true={record.isFolio}>
                                                                                            <lightning-icon icon-name="utility:success" alternative-text="Tiene Folio" title="Tiene Folio" style="--lwc-colorTextIconDefault: green;"></lightning-icon>
                                                                                        </div>
                                                                                        <div if:false={record.isFolio}>                                                                                            
                                                                                            <lightning-icon icon-name="utility:error" alternative-text="No tiene Folio" title="No tiene Folio" style="--lwc-colorTextIconDefault: red;"></lightning-icon>
                                                                                        </div>
                                                                                    </div>
                                                                                </td>  
                                                                                <td data-label="Invoice">
                                                                                    <div class="slds-truncate">                                                                                        
                                                                                        <div if:true={record.isInvoice}>
                                                                                            <lightning-icon icon-name="utility:success" alternative-text="Tiene Invoice" title="Tiene Invoice" style="--lwc-colorTextIconDefault: green;"></lightning-icon>
                                                                                        </div>
                                                                                        <div if:false={record.isInvoice}>                                                                                            
                                                                                            <lightning-icon icon-name="utility:error" alternative-text="No tiene Invoice" title="No tiene Invoice" style="--lwc-colorTextIconDefault: red;"></lightning-icon>
                                                                                        </div>
                                                                                    </div>
                                                                                </td>                                                                                                                            
                                                                            </tr>                                           
                                                                        </tbody>
                                                                    </template>
                                                                </table>    
                                                            </div>   
                                                            <br/>                                                                                                                                                                                 
                                                        </div>
                                                    </div>
                                                </div>                                            
                                            </div>
                                        </lightning-tab>
                                        <lightning-tab label="Lineas Omitidas">
                                            <div>
                                                <div class="slds-p-around_medium lgc-bg">
                                                    <div class="slds-box slds-theme_shade">
                                                        <h2><b style="color: red;">ATENCION:</b>&nbsp; No se van a registras las siguientes lineas debito a que no estan vendida(s): <br/></h2>                                                            
                                                    </div><br/>                                                 
                                                    <div class="slds-scrollable" style="height:100%; height: 100%;">                                       
                                                        <div class="slds-text-longform">                                                                                       
                                                            <template for:each={shipmentsUnsold} for:item="record">                                
                                                                <h3 class="slds-text-heading_medium slds-m-bottom_xx-small" key={record.Id}>Shipment Number: <b style="color:red">{record.shipmentName}</b> - Status: <b style="color:red">{record.statusSp}</b></h3>                                                                                                                                   
                                                                    <div class="slds-scrollable" style="height:100%; height: 100%;" key={record.Id}>
                                                                        <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                                                                            <thead>
                                                                                <tr class="slds-line-height_reset">
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Services Line">Services Line Name</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Carrier">Carrier</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Rate Category">Rate Category</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Codigo Sap">Codigo Sap</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Rate Name">Rate Name</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Units">Units</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Buy Amount">Buy Amount</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Sell Net Amount">Sell Net Amount</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Services Profit">Services Profit</div>
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <template for:each={record.servicesLines} for:item="line">
                                                                                <tbody key={line.Id}>
                                                                                    <tr class="slds-hint-parent">
                                                                                        <th data-label="Services Line" scope="row">
                                                                                            <div class="slds-truncate" title={line.Name}>{line.Name}</div>
                                                                                        </th>
                                                                                        <td data-label="Carrier">
                                                                                            <div class="slds-truncate" title={line.Carrier__c}>{line.Carrier__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Rate Category">
                                                                                            <div class="slds-truncate" title={line.Service_Rate_Category__c>{line.Service_Rate_Category__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Codigo Sap">
                                                                                            <div class="slds-truncate" title={line.Code_SAP__c}>{line.Code_SAP__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Rate Name">
                                                                                            <div class="slds-truncate" title={line.Service_Rate_Name__c}>{line.Service_Rate_Name__r.Name}</div>
                                                                                        </td>
                                                                                        <td data-label="Units">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Units__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Buy Amount">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Std_Buy_Amount_header_currency__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Sell Net Amount">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Sell_Amount__c}</div>
                                                                                        </td> 
                                                                                        <td data-label="Services Profit">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Service_Std_Profit__c}</div>
                                                                                        </td>                                                
                                                                                    </tr>                                           
                                                                                </tbody>
                                                                            </template>
                                                                        </table>    
                                                                    </div>   
                                                                    <br key={record}/>                                                                                                                                                                                                      
                                                            </template>                               
                                                        </div>
                                                    </div>
                                                </div>                                            
                                            </div>
                                        </lightning-tab>                                   
                                    </lightning-tabset>                                                                                   
                                </div>                    
                            </div>
                            <footer class="slds-modal__footer">                        
                                <lightning-button variant="success" label="Confirmar" title="Save Debit Note" onclick={generateInvoice} class="slds-m-left_x-small" ></lightning-button>
                                <lightning-button variant="destructive" label="Cerrar" title="Closed Action" onclick={closeModal} class="slds-m-left_x-small"></lightning-button>
                                <lightning-button label="Regresar" title="Regresar" onclick={regresarModal} class="slds-m-left_x-small"></lightning-button>                                                
                            </footer>
                        </div>
                    </section>
                </div>
                <div if:true={manyDebitNotes}>
                    <section role=" dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
                        <div class="slds-modal__container">                                                                                                          
                            <header class="slds-modal__header">
                                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                                    <lightning-icon icon-name="utility:close"
                                        alternative-text="close"
                                        variant="inverse"
                                        size="small" ></lightning-icon>
                                    <span class="slds-assistive-text">Close</span>
                                </button>
                                <h2 class="slds-text-heading_medium slds-hyphenate">Debit Notes encontradas</h2>
                            </header>
                        
                            <div class="slds-is-relative">
                                <div if:true={isLoadedAll}>
                                    <lightning-spinner
                                        alternative-text="Loading..." variant="brand" size="large" >
                                    </lightning-spinner>
                                </div>                                                         
                                <div class="slds-modal__content">                               
                                    <lightning-tabset variant="scoped"> 
                                        <lightning-tab label="Seleccionar Debit Note">
                                            <div>
                                                <div class="slds-p-around_medium lgc-bg">
                                                    <div class="slds-box slds-theme_shade">
                                                        <h2><b style="color: red;">ATENCION:</b>&nbsp; Se ha encontrado varias Debit Notes. Seleccione una Debit Note para relacionar a los Shipments Omitidos</h2>
                                                    </div><br/>                                                 
                                                    <div class="slds-scrollable" style="height:100%; height: 100%;">                                       
                                                        <div class="slds-text-longform">                                                                                                                                                   
                                                            <div class="slds-scrollable_x">
                                                                <table class="slds-table slds-table_bordered slds-table_fixed-layout slds-table_resizable-cols" role="grid" aria-label="Example advanced table as radio group">
                                                                    <thead>
                                                                        <tr class="slds-line-height_reset">
                                                                            <th class="slds-text-align_right" scope="col" style="width:3.25rem">
                                                                            <div class="slds-truncate slds-assistive-text" title="Choose a row to select">Choose a row to select</div>
                                                                            </th>
                                                                            <th aria-label="Debit Note" aria-sort="none" class="slds-is-resizable slds-is-sortable" scope="col">
                                                                                <a class="slds-th__action slds-text-link_reset" href="#" role="button" tabindex="-1">
                                                                                    <span class="slds-assistive-text">Sort by: </span>
                                                                                    <div class="slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate">
                                                                                        <span class="slds-truncate" title="Debit Note">Debit Note</span>
                                                                                        <span class="slds-icon_container slds-icon-utility-arrowdown">
                                                                                        <svg class="slds-icon slds-icon-text-default slds-is-sortable__icon " aria-hidden="true">
                                                                                            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#arrowdown"></use>
                                                                                        </svg>
                                                                                        </span>
                                                                                    </div>
                                                                                </a>
                                                                                <div class="slds-resizable">
                                                                                    <input type="range" aria-label="Name column width" class="slds-resizable__input slds-assistive-text" max="1000" min="20" tabindex="-1" />
                                                                                    <span class="slds-resizable__handle">
                                                                                    <span class="slds-resizable__divider"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </th>
                                                                            <th aria-label="Created By" aria-sort="none" class="slds-is-resizable slds-is-sortable" scope="col">
                                                                                <a class="slds-th__action slds-text-link_reset" href="#" role="button" tabindex="-1">
                                                                                    <span class="slds-assistive-text">Sort by: </span>
                                                                                    <div class="slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate">
                                                                                        <span class="slds-truncate" title="Created By">Created By</span>
                                                                                        <span class="slds-icon_container slds-icon-utility-arrowdown">
                                                                                        <svg class="slds-icon slds-icon-text-default slds-is-sortable__icon " aria-hidden="true">
                                                                                            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#arrowdown"></use>
                                                                                        </svg>
                                                                                        </span>
                                                                                    </div>
                                                                                </a>
                                                                                <div class="slds-resizable">
                                                                                    <input type="range" aria-label="Account Name column width" class="slds-resizable__input slds-assistive-text"  max="1000" min="20" tabindex="-1" />
                                                                                    <span class="slds-resizable__handle">
                                                                                    <span class="slds-resizable__divider"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </th>
                                                                            <th aria-label="Created Date" aria-sort="none" class="slds-is-resizable slds-is-sortable" scope="col">
                                                                                <a class="slds-th__action slds-text-link_reset" href="#" role="button" tabindex="-1">
                                                                                    <span class="slds-assistive-text">Sort by: </span>
                                                                                    <div class="slds-grid slds-grid_vertical-align-center slds-has-flexi-truncate">
                                                                                        <span class="slds-truncate" title="Created Date">Created Date</span>
                                                                                        <span class="slds-icon_container slds-icon-utility-arrowdown">
                                                                                        <svg class="slds-icon slds-icon-text-default slds-is-sortable__icon " aria-hidden="true">
                                                                                            <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#arrowdown"></use>
                                                                                        </svg>
                                                                                        </span>
                                                                                    </div>
                                                                                </a>
                                                                                <div class="slds-resizable">
                                                                                    <input type="range" aria-label="Close Date column width" class="slds-resizable__input slds-assistive-text" max="1000" min="20" tabindex="-1" />
                                                                                    <span class="slds-resizable__handle">
                                                                                        <span class="slds-resizable__divider"></span>
                                                                                    </span>
                                                                                </div>
                                                                            </th>                    
                                                                        </tr>
                                                                        </thead>
                                                                        <template for:each={debitNotes} for:item="record">    
                                                                            <tbody key={record.Id}>
                                                                                <tr class="slds-hint-parent">
                                                                                <td class="slds-text-align_right" role="gridcell">
                                                                                    <span class="slds-radio">
                                                                                    <input type="radio" id={record.Id} value={record.Id} name="options" tabindex="-1" onclick={getDebitNoteId} data-id={record.Id}/>
                                                                                        <label class="slds-radio__label" for={record.Id}>
                                                                                            <span class="slds-radio_faux"></span>
                                                                                            <span class="slds-form-element__label slds-assistive-text">{record.Id}</span>
                                                                                        </label>
                                                                                    </span>
                                                                                </td>
                                                                                <th scope="row" tabindex="0">
                                                                                    <div class="slds-truncate" title={record.Name}>
                                                                                        {record.Name}                                                                                        
                                                                                    </div>
                                                                                </th>
                                                                                <td role="gridcell">
                                                                                    <div class="slds-truncate" title={record.CreatedBy.Name}>{record.CreatedBy.Name}</div>
                                                                                </td>
                                                                                <td role="gridcell">
                                                                                    <div class="slds-truncate"><lightning-formatted-date-time value={record.CreatedDate}></lightning-formatted-date-time></div>
                                                                                </td>                        
                                                                                </tr>                
                                                                            </tbody>
                                                                        </template>
                                                                </table>   
                                                            </div>                                                                                                                                                                                                                                                                                         
                                                        </div>
                                                    </div>
                                                </div>                                            
                                            </div>
                                        </lightning-tab>                                                                           
                                    </lightning-tabset>                                                                                   
                                </div>                    
                            </div>
                            <footer class="slds-modal__footer">                        
                                <lightning-button variant="success" label="Confirmar" title="Save Debit Note" onclick={createInvoices} class="slds-m-left_x-small" ></lightning-button>
                                <lightning-button variant="destructive" label="Cerrar" title="Closed Action" onclick={closeModal} class="slds-m-left_x-small"></lightning-button>                                
                            </footer>
                        </div>
                    </section>
                </div>
                <div if:true={isDetailModal}>
                    <section role=" dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_medium">                        
                        <div class="slds-modal__container">                                                                                                           
                            <header class="slds-modal__header">
                                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                                    <lightning-icon icon-name="utility:close"
                                        alternative-text="close"
                                        variant="inverse"
                                        size="small" ></lightning-icon>
                                    <span class="slds-assistive-text">Close</span>
                                </button>
                                <h2 class="slds-text-heading_medium slds-hyphenate">Detalles de la Invoice Debit Note</h2>
                            </header>  
                            <div class="slds-is-relative">
                                <div if:true={isLoadedAll} style="position:relative">
                                    <lightning-spinner
                                        alternative-text="Loading..." variant="brand" size="large" >
                                    </lightning-spinner>
                                </div>
                            </div>    
                            <div class="slds-modal__content slds-p-around_medium" style="height: 500px;">
                                <lightning-tabset variant="scoped">
                                    <lightning-tab label="Invoices Generadas">
                                        <div class="slds-p-around_medium lgc-bg">
                                            <div class="slds-scrollable" style="height:100%; height: 100%;">
                                                <div class="slds-text-longform">
                                                    <div class="slds-modal__content slds-p-around_medium">                                                        
                                                        <template for:each={invoiceResponse} for:item="record">
                                                            <article class="slds-card" key={record}>
                                                                <div class="slds-card__header slds-grid">
                                                                    <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                                                        <div class="slds-media__figure">
                                                                            <span class="slds-icon_container slds-icon-standard-contact" title="contact">                                                    
                                                                                <lightning-icon icon-name="custom:custom18" alternative-text="Approved" title="Invoice"></lightning-icon>                                                                                                        
                                                                            </span>
                                                                        </div>
                                                                        <div class="slds-media__body">
                                                                            <h2 class="slds-card__header-title">
                                                                                <lightning-formatted-url value={record.urlInvoice} label={record.invoice.Name} target="_blank"></lightning-formatted-url>                                                                                
                                                                            </h2>
                                                                        </div>
                                                                        <div class="slds-no-flex">                                                
                                                                        </div>
                                                                    </header>
                                                                </div>
                                                                <div class="slds-card__body">
                                                                    <div class="slds-scrollable_x" style="height:100%; height: 100%">
                                                                        <table class="slds-table slds-table_cell-buffer slds-no-row-hover slds-table_bordered slds-table_fixed-layout" role="grid">
                                                                            <thead>
                                                                                <tr class="slds-line-height_reset">
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Invoice Line Name">Invoice Line Name</div>
                                                                                    </th>                                                        
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Concept">Concept</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Units">Units</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Unit Price">Unit Price</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Total (Excl.VAT)">Total (Excl.VAT)</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="VAT">VAT</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Total VAT">Total VAT</div>
                                                                                    </th>
                                                                                    <th class="" scope="col">
                                                                                        <div class="slds-truncate" title="Total (incl. VAT)">Total (incl. VAT)</div>
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <template for:each={record.invoiceLine} for:item="line">
                                                                                <tbody key={line.Id}>
                                                                                    <tr class="slds-hint-parent">
                                                                                        <th data-label="Invoice Line Name" scope="row">
                                                                                            <div class="slds-truncate" title={line.Name}>{line.Name}</div>
                                                                                        </th>                                                           
                                                                                        <td data-label="Concept">
                                                                                            <div class="slds-truncate" title={line.Concept__c>{line.Concept__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Units">
                                                                                            <div class="slds-truncate" title={line.Units__c}>{line.Units__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Unit Price">
                                                                                            <div class="slds-truncate" title={line.Unit_Price__c}>{line.Unit_Price__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Total (Excl.VAT)">
                                                                                            <div class="slds-truncate" title={line.Amount__c}>{line.Amount__c}</div>
                                                                                        </td>
                                                                                        <td data-label="VAT">
                                                                                            <div class="slds-truncate" title={line.VAT__c}>{line.VAT__c}</div>
                                                                                        </td>
                                                                                        <td data-label="Total VAT">
                                                                                            <div class="slds-truncate" title={line.Total_VAT__c}>{line.Total_VAT__c}</div>
                                                                                        </td> 
                                                                                        <td data-label="Total (incl. VAT)">
                                                                                            <div class="slds-truncate" title={line.Total_Incl_VAT__c}>{line.Total_Incl_VAT__c}</div>
                                                                                        </td>                                                
                                                                                    </tr>                                           
                                                                                </tbody>
                                                                            </template>
                                                                        </table>    
                                                                    </div>                                        
                                                                </div>
                                                                <footer class="slds-card__footer">                                        
                                                                </footer>
                                                            </article>                                                                                                                                                                                                                                                                                                            
                                                        </template>                               
                                                    </div>                    
                                                </div>
                                            </div>
                                        </div>
                                    </lightning-tab>
                                </lightning-tabset>                                                                                                          
                            </div>  
                            <footer class="slds-modal__footer">                        
                                <lightning-button variant="success" label="Finalizar" title="Finalizar" onclick={finalizar} class="slds-m-left_x-small" ></lightning-button>                                                                      
                            </footer>                                                      
                        </div>                  
                    </section>
                </div>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>        
        </div>    
    </div>        
 </template>